<Attributes>
	<Attribute name="CalculateJobRewards"><![CDATA[
            #program;
            {
                // Result is placed in arr1
                function combineRewards(arr1, arr2)
                {
                    for(var i = 0; i < Array::size(arr2); i++)
                    {
                        var old = Array::getValueForKey(arr1, Array::getKeyAtIndex(arr2, i));
                        var value = 0;
                        if(!isNULL(old))
                        {
                            value += toDouble(old);
                        }
                        value += toDouble(Array::getValueAtIndex(arr2, i));

                        Array::addValueForUniqueKey(arr1, Array::getKeyAtIndex(arr2, i), value);
                    }
                }

                function getJobRewardIfAvailable(characterName, jobName)
                {
                    var character = Land::getFirstInstanceOfObject(Character::find(characterName));
                    if(!isNULL(character))
                    {
                        if(isNULL(Character::getCurrentJobInstance(character)))
                        {
                            var job = Job::find(jobName);
                            return Job::getReward(job, toGameObject(character));
                        }
                    }
                    return Array::create();
                }
                var reward = Array::create();

                // Fire jobs all follow this naming convention
                var jobReward = getJobRewardIfAvailable('Homer', p_jobName+'_Premium_Homer');
                combineRewards(reward,jobReward);

                jobReward = getJobRewardIfAvailable('Apu', p_jobName+'_Premium_Apu');
                combineRewards(reward,jobReward);

                jobReward = getJobRewardIfAvailable('Moe',p_jobName);
                combineRewards(reward,jobReward);

                jobReward = getJobRewardIfAvailable('Skinner',p_jobName+'_Skinner');
                combineRewards(reward,jobReward);

                return reward;
            }
        ]]></Attribute>
</Attributes>
