<ScriptPackage>
	<ShowEventIntro>
		<Action type="miniEventPanel">
			<Attribute name="config">
				<AttributeSet name="source">
					<Attribute name="file" value="BreakoutBountyMiniEventPopUp" />
				</AttributeSet>
				<AttributeSet name="playButtonText">
					<Requirement type="variable" variable="BreakoutBounty_IntroSeen" not="true" />
					<Attribute name="text" value="UI_MiniEvents_PlayButton" localise="true" />
				</AttributeSet>
				<AttributeSet name="playButtonTextHL">
					<Requirement type="variable" variable="BreakoutBounty_IntroSeen" not="true" />
					<Attribute name="text" value="UI_MiniEvents_PlayButton" localise="true" />
				</AttributeSet>
				<AttributeSet name="playButtonText">
					<Requirement type="variable" variable="BreakoutBounty_IntroSeen" />
					<Attribute name="text" value="UI_OK" localise="true" />
				</AttributeSet>
				<AttributeSet name="playButtonTextHL">
					<Requirement type="variable" variable="BreakoutBounty_IntroSeen" />
					<Attribute name="text" value="UI_OK" localise="true" />
				</AttributeSet>
				<AttributeSet name="titleText">
					<Attribute name="text" value="UI_BreakoutBounty_Title" localise="true" />
					<Attribute name="color" value="ffcb1bff" />
				</AttributeSet>
				<AttributeSet name="timeLeft">
					<Attribute name="text" value="UI_BreakoutBounty_IntroPanelFooter" localise="true" />
					<Attribute name="color" value="FFFFFFFF" />
				</AttributeSet>
				<AttributeSet name="textColumn1">
					<Attribute name="text" value="UI_BreakoutBounty_IntroPanelText_1" localise="true" />
					<Attribute name="color" value="000000FF" />
				</AttributeSet>
				<AttributeSet name="textColumn2">
					<Attribute name="text" value="UI_BreakoutBounty_IntroPanelText_2" localise="true" />
					<Attribute name="color" value="000000FF" />
				</AttributeSet>
				<AttributeSet name="panel">
					<Attribute name="image" value="BSE_BreakoutBounty_MiniEventPanel_Intro" />
				</AttributeSet>
				<AttributeSet name="playButton">
					<Attribute name="color" value="0091F1FF" />
				</AttributeSet>
			</Attribute>
		</Action>
		<Action type="setVariable" boolVariable="BreakoutBounty_IntroSeen" boolValue="true" />
		<Action type="updateVariable" variable="BreakoutBounty_Store" value="true" />
		<Action type="recommendation" recType="Event" name="BreakoutBounty_BreakoutBounty_OnePanel" eventName="UI_BreakoutBounty_Title" limitedTime="true" limitedTimeEndDate="BreakoutBounty_End" />
		<Action type="reparseBuildMenu" />
	</ShowEventIntro>
	<ShowEventOutro>
		<Action type="miniEventPanel">
			<Attribute name="config">
				<AttributeSet name="source">
					<Attribute name="file" value="BreakoutBountyMiniEventPopUp" />
				</AttributeSet>
				<AttributeSet name="playButtonText">
					<Attribute name="text" value="UI_OK" localise="true" />
				</AttributeSet>
				<AttributeSet name="playButtonTextHL">
					<Attribute name="text" value="UI_OK" localise="true" />
				</AttributeSet>
				<AttributeSet name="titleText">
					<Attribute name="text" value="UI_BreakoutBounty_Title" localise="true" />
					<Attribute name="color" value="ffcb1bff" />
				</AttributeSet>
				<AttributeSet name="textColumn4">
					<Attribute name="text" value="UI_BreakoutBounty_OutroPanelText_1" localise="true" />
					<Attribute name="color" value="000000FF" />
				</AttributeSet>
				<AttributeSet name="textColumn5">
					<Attribute name="text" value="UI_BreakoutBounty_OutroPanelText_2" localise="true" />
					<Attribute name="color" value="000000FF" />
				</AttributeSet>
				<AttributeSet name="panel">
					<Attribute name="image" value="BSE_BreakoutBounty_MiniEventPanel_Outro" />
				</AttributeSet>
				<AttributeSet name="playButton">
					<Attribute name="color" value="0091F1FF" />
				</AttributeSet>
			</Attribute>
		</Action>
	</ShowEventOutro>
	<ExpiryWarning_72hr>
		<Action type="message" text="UI_BreakoutBounty_72HourExpiry_text" />
		<Action type="setVariable" boolVariable="BreakoutBounty_PreExpiryDisplayed72" boolValue="true" />
		<Action type="runScript" script="BreakoutBounty_Scripts:OpenMasterQuest" waitUntilComplete="true" />
	</ExpiryWarning_72hr>
	<ExpiryWarning_24hr>
		<Action type="message" text="{FormattedExpiration24}" formatMe="root">
			<FormattingConfig path="BreakoutBounty_GameConfig:ExpirationFormattedText" />
		</Action>
		<Action type="setVariable" boolVariable="BreakoutBounty_PreExpiryDisplayed24" boolValue="true" />
		<Action type="runScript" script="BreakoutBounty_Scripts:OpenMasterQuest" waitUntilComplete="true" />
	</ExpiryWarning_24hr>
	<DisplayExpiry>
		<Action type="message" text="UI_BreakoutBounty_Expired_text" />
		<Action type="clearRecommendations" category="Event" name="BreakoutBounty_OnePanel" />
		<Action type="runScript" script="BreakoutBounty_Scripts:OpenMasterQuest" waitUntilComplete="true" />
	</DisplayExpiry>
	<EventCompleted>
		<Action type="setVariable" boolVariable="BreakoutBounty_Complete" boolValue="true" />
	</EventCompleted>
	<OpenMasterQuest>
		<Action type="checkRequirements">
			<Requirement type="gamestate" state="GameState_QuestProgress" />
			<True>
				<Action type="changeQuestForProgressState" name="BreakoutBounty_MasterQuest" />
			</True>
			<False>
				<Action type="gotoState" state="GameState_QuestProgress" forceState="true">
					<Extras>
						<Attribute name="questParentDelegate" value="BreakoutBounty_MasterQuest" />
					</Extras>
				</Action>
			</False>
		</Action>
	</OpenMasterQuest>
	<ShowJobList ignoreHUD="true">
		<Action type="checkRequirements">
			<Requirement type="land" land="Springfield" />
			<True>
				<Action type="if">
					<If>
						<Requirement type="active quest" quest="BountyOfBounties_1" />
						<Then>
							<Action type="gotoState" state="GameState_SpecialEventJobList">
								<Extras>
									<Attribute name="SpecialEvent" value="BreakoutBounty_Event" />
									<Attribute name="JobList" value="BreakoutBounty_JL_1" />
								</Extras>
							</Action>
						</Then>
					</If>
					<ElseIf>
						<Requirement type="active quest" quest="BountyOfBounties_2" />
						<Then>
							<Action type="gotoState" state="GameState_SpecialEventJobList">
								<Extras>
									<Attribute name="SpecialEvent" value="BreakoutBounty_Event" />
									<Attribute name="JobList" value="BreakoutBounty_JL_2" />
								</Extras>
							</Action>
						</Then>
					</ElseIf>
					<ElseIf>
						<Requirement type="active quest" quest="BountyOfBounties_3" />
						<Then>
							<Action type="gotoState" state="GameState_SpecialEventJobList">
								<Extras>
									<Attribute name="SpecialEvent" value="BreakoutBounty_Event" />
									<Attribute name="JobList" value="BreakoutBounty_JL_3" />
								</Extras>
							</Action>
						</Then>
					</ElseIf>
					<ElseIf>
						<Requirement type="active quest" quest="BountyOfBounties_4" />
						<Then>
							<Action type="gotoState" state="GameState_SpecialEventJobList">
								<Extras>
									<Attribute name="SpecialEvent" value="BreakoutBounty_Event" />
									<Attribute name="JobList" value="BreakoutBounty_JL_4" />
								</Extras>
							</Action>
						</Then>
					</ElseIf>
					<ElseIf>
						<Requirement type="active quest" quest="BountyOfBounties_5" />
						<Then>
							<Action type="gotoState" state="GameState_SpecialEventJobList">
								<Extras>
									<Attribute name="SpecialEvent" value="BreakoutBounty_Event" />
									<Attribute name="JobList" value="BreakoutBounty_JL_5" />
								</Extras>
							</Action>
						</Then>
					</ElseIf>
				</Action>
			</True>
			<False>
				<Action type="pantoobject" building="KrustylandShuttleToSpringfield" fakeTouch="true" />
			</False>
		</Action>
	</ShowJobList>
	<CheckIfEnd ignoreHUD="true">
		<Action type="checkRequirements">
			<Requirement type="quest" quest="BreakoutBounty_EventExpired" />
			<True>
				<Action type="setVariable" boolVariable="BreakoutBounty_Expired" boolValue="true" />
			</True>
		</Action>
	</CheckIfEnd>
	<RecommendStoreCategory_BreakoutBounty ignoreHUD="true">
		<Action type="reparseBuildMenu" />
		<Action type="clearRecommendations" category="Event" name="BreakoutBounty_BreakoutBounty_OnePanel" />
		<Action type="recommendation" recType="Event" name="BreakoutBounty_BreakoutBounty_OnePanel" eventName="UI_BreakoutBounty_Title" limitedTime="true" limitedTimeEndDate="BreakoutBounty_End" />
		<Action type="focusOnMenuItem" menuCategory="FrontPage" />
		<Action type="reparseBuildMenu" />
	</RecommendStoreCategory_BreakoutBounty>
	<EnterStoreCategory_BreakoutBounty ignoreHUD="true">
		<Action type="focusOnMenuItem" menuCategory="BreakoutBounty_Category" />
	</EnterStoreCategory_BreakoutBounty>
	<BreakoutBounty_MTX_DisplayPromo ignoreHUD="true">
		<Action type="focusOnMenuItem" menuCategory="Currency" itemName="BreakoutBounty_TrayOfDonuts" />
	</BreakoutBounty_MTX_DisplayPromo>
	<EscapedConvictTapped parallel="true" cache="true">
		<Action type="if">
			<If expression="Object::Fleeing == 1">
				<Then>
					<Action type="runScriptOnAll" character="EscapedConvict" in_radius="1" radius_delay="0.3" script="BreakoutBounty_Scripts:EscapedConvictTapped_Single" />
					<Action type="actionSequence" script="BreakoutBounty_Scripts:EscapedConvictTapped_Single" />
				</Then>
			</If>
			<Else>
				<Then>
					<Action type="if">
						<If expression="greaterThanEQ(rand(100), 70)">
							<Then>
								<Action type="sound" sound="EscapedConvict_runaway" />
								<Action type="setObjectVariable" variable="Fleeing" value="1" asExpression="true" allowOrphan="false" />
								<Action type="setMovementBehavior">
									<MovementBehavior mode="sneak">
										<RandomSpeed minSpeed="250" maxSpeed="250" />
										<BuildingVisit maxTime="0" minTime="0" />
									</MovementBehavior>
								</Action>
								<Action type="scheduleScript" script="BreakoutBounty_Scripts:ResetFleeingConvict" relativeTime="20s" />
							</Then>
						</If>
						<Else>
							<Then>
								<Action type="runScriptOnAll" character="EscapedConvict" in_radius="5" radius_delay="0.3" script="BreakoutBounty_Scripts:EscapedConvictTapped_Single" />
								<Action type="actionSequence" script="BreakoutBounty_Scripts:EscapedConvictTapped_Single" />
							</Then>
						</Else>
					</Action>
				</Then>
			</Else>
		</Action>
	</EscapedConvictTapped>
	<EscapedConvictTapped_Single parallel="true" cache="true">
		<Action type="if">
			<If expression="bitwiseAnd([Object::ObjectFlags], 1) == 0" asObjectExpression="true">
				<Then>
					<Action type="updateVariable" variable="EscapedConvictTapped" value="EscapedConvictTapped + 1" />
					<Action type="setObjectFlag" flags="delete" />
					<Action type="sound" sound="EscapedConvict_Tap" />
					<Action type="if">
						<If expression="[Object::SkinID]==0" asObjectExpression="true">
							<Then>
								<Action type="anim-play" animation="Squish" />
							</Then>
						</If>
						<ElseIf expression="[Object::SkinID]==248000" asObjectExpression="true">
							<Then>
								<Action type="anim-play" animation="Fugitive02_Squish" />
							</Then>
						</ElseIf>
						<ElseIf expression="[Object::SkinID]==248001" asObjectExpression="true">
							<Then>
								<Action type="anim-play" animation="Fugitive03_Squish" />
							</Then>
						</ElseIf>
					</Action>
					<Action type="anim-waitforend" />
					<Action type="fade" fade="outmax" />
					<Action type="deletecharacter" character="EscapedConvict" />
					<Action type="if">
						<If expression="#program;                             if(User::getVariable('BankedEscapedConvictTappables') &gt; 3)                             {                                 return false;                             }                             else                             {                                 var character = Character::find('EscapedConvict');                                 var characterInstanceList = Land::getAllInstancesOfObject(character);                                 foreach(characterInstanceList as instance)                                 {                                     if(!Object::getDelete(instance))                                     {                                         return false;                                     }                                 }                             }                             return true;">
							<Then>
								<Action type="createobject" name="EscapedConvict" count="3" save="true" panCamera="false" />
							</Then>
						</If>
					</Action>
				</Then>
			</If>
		</Action>
	</EscapedConvictTapped_Single>
	<ClearTappable>
		<Action type="if">
			<If expression="bitwiseAnd([Object::ObjectFlags], 1) == 0" asObjectExpression="true">
				<Then>
					<Action type="setObjectFlag" flags="delete" />
					<Action type="fade" fade="outmax" />
					<Action type="deletecharacter" character="EscapedConvict" />
				</Then>
			</If>
		</Action>
	</ClearTappable>
	<ClearAllTappables>
		<Action type="updateVariable" variable="BankedEscapedConvictTappables" value="0" />
		<Action type="updateVariable" variable="EscapedConvictTapped" value="100" />
		<Action type="runScriptOnAll" character="EscapedConvict" script="BreakoutBounty_Scripts:ClearTappable" />
	</ClearAllTappables>
	<ResetFleeingConvict>
		<Action type="setMovementBehavior">
			<MovementBehavior mode="sneak">
				<RandomSpeed minSpeed="50" maxSpeed="50" />
				<BuildingVisit maxTime="0" minTime="0" />
			</MovementBehavior>
		</Action>
	</ResetFleeingConvict>
	<SpawnFullHudTip>
		<Action type="hudTip" text="UI_BreakoutBounty_Convicts_TownFull_text" time="3s" queue="true" waitForHUD="true" />
	</SpawnFullHudTip>
	<ShowTappablesGuidePanel ignoreHUD="true">
		<Action type="gotoState" state="State_HubEventGuidePanel" extras="BreakoutBounty_GameConfig:TappablesGuide_Config" />
	</ShowTappablesGuidePanel>
	<ExitGuidePanel ignoreHUD="true">
		<Action type="gotoState" state="GameState_InGame" />
	</ExitGuidePanel>
</ScriptPackage>