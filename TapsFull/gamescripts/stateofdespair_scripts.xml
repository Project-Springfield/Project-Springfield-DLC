<ScriptPackage>
	<ShowEventIntro>
		<Action type="miniEventPanel">
			<Attribute name="config">
				<AttributeSet name="source">
					<Attribute name="file" value="StateOfDespairMiniEventPopUp" />
				</AttributeSet>
				<AttributeSet name="playButtonText">
					<Requirement type="variable" variable="StateOfDespair_IntroSeen" not="true" />
					<Attribute name="text" value="UI_MiniEvents_PlayButton" localise="true" />
				</AttributeSet>
				<AttributeSet name="playButtonTextHL">
					<Requirement type="variable" variable="StateOfDespair_IntroSeen" not="true" />
					<Attribute name="text" value="UI_MiniEvents_PlayButton" localise="true" />
				</AttributeSet>
				<AttributeSet name="playButtonText">
					<Requirement type="variable" variable="StateOfDespair_IntroSeen" />
					<Attribute name="text" value="UI_OK" localise="true" />
				</AttributeSet>
				<AttributeSet name="playButtonTextHL">
					<Requirement type="variable" variable="StateOfDespair_IntroSeen" />
					<Attribute name="text" value="UI_OK" localise="true" />
				</AttributeSet>
				<AttributeSet name="titleText">
					<Attribute name="text" value="UI_StateOfDespair_Title" localise="true" />
					<Attribute name="color" value="ffcb1bff" />
				</AttributeSet>
				<AttributeSet name="timeLeft">
					<Attribute name="text" value="UI_StateOfDespair_IntroPanel_Timer" localise="true" />
					<Attribute name="color" value="FFFFFFFF" />
				</AttributeSet>
				<AttributeSet name="textColumn1">
					<Attribute name="text" value="UI_StateOfDespair_IntroPanel_1" localise="true" />
					<Attribute name="color" value="000000FF" />
				</AttributeSet>
				<AttributeSet name="textColumn3">
					<Attribute name="text" value="UI_StateOfDespair_IntroPanel_2" localise="true" />
					<Attribute name="color" value="000000FF" />
				</AttributeSet>
				<AttributeSet name="panel">
					<Attribute name="image" value="BSE_StateOfDespair_MiniEventPanel_Intro" />
				</AttributeSet>
				<AttributeSet name="playButton">
					<Attribute name="color" value="0091F1FF" />
				</AttributeSet>
			</Attribute>
		</Action>
		<Action type="setVariable" boolVariable="StateOfDespair_IntroSeen" boolValue="true" />
		<Action type="updateVariable" variable="StateOfDespair_Store" value="true" />
		<Action type="recommendation" recType="Event" name="StateOfDespair_OnePanel" eventName="UI_StateOfDespair_Title" limitedTime="true" limitedTimeEndDate="StateOfDespair_End" />
		<Action type="reparseBuildMenu" />
	</ShowEventIntro>
	<ShowEventOutro>
		<Action type="miniEventPanel">
			<Attribute name="config">
				<AttributeSet name="source">
					<Attribute name="file" value="StateOfDespairMiniEventPopUp" />
				</AttributeSet>
				<AttributeSet name="playButtonText">
					<Attribute name="text" value="UI_OK" localise="true" />
				</AttributeSet>
				<AttributeSet name="playButtonTextHL">
					<Attribute name="text" value="UI_OK" localise="true" />
				</AttributeSet>
				<AttributeSet name="titleText">
					<Attribute name="text" value="UI_StateOfDespair_Title" localise="true" />
					<Attribute name="color" value="ffcb1bff" />
				</AttributeSet>
				<AttributeSet name="textColumn4">
					<Attribute name="text" value="UI_StateOfDespair_OutroPanel_1" localise="true" />
					<Attribute name="color" value="000000FF" />
				</AttributeSet>
				<AttributeSet name="textColumn5">
					<Attribute name="text" value="UI_StateOfDespair_OutroPanel_2" localise="true" />
					<Attribute name="color" value="000000FF" />
				</AttributeSet>
				<AttributeSet name="panel">
					<Attribute name="image" value="BSE_StateOfDespair_MiniEventPanel_Outro" />
				</AttributeSet>
				<AttributeSet name="playButton">
					<Attribute name="color" value="0091F1FF" />
				</AttributeSet>
			</Attribute>
		</Action>
		<Action type="setVariable" boolVariable="StateOfDespair_Complete" boolValue="true" />
	</ShowEventOutro>
	<ExpiryWarning_72hr>
		<Action type="message" text="UI_StateOfDespair_72HourExpiry_text" />
		<Action type="setVariable" boolVariable="StateOfDespair_PreExpiryDisplayed72" boolValue="true" />
		<Action type="runScript" script="StateOfDespair_Scripts:OpenMasterQuest" waitUntilComplete="true" />
	</ExpiryWarning_72hr>
	<ExpiryWarning_24hr>
		<Action type="message" text="{FormattedExpiration24}" formatMe="root">
			<FormattingConfig path="StateOfDespair_GameConfig:ExpirationFormattedText" />
		</Action>
		<Action type="setVariable" boolVariable="StateOfDespair_PreExpiryDisplayed24" boolValue="true" />
		<Action type="runScript" script="StateOfDespair_Scripts:OpenMasterQuest" waitUntilComplete="true" />
	</ExpiryWarning_24hr>
	<DisplayExpiry>
		<Action type="message" text="UI_StateOfDespair_Expired_text" />
		<Action type="clearRecommendations" category="Event" name="StateOfDespair_OnePanel" />
		<Action type="runScript" script="StateOfDespair_Scripts:OpenMasterQuest" waitUntilComplete="true" />
	</DisplayExpiry>
	<OpenEventHub>
		<Action type="if">
			<If expression="StateOfDespair_EventHubTabValue == 0">
				<Then>
					<Action type="runScript" script="StateOfDespair_Scripts:Tab_Week1" />
				</Then>
			</If>
		</Action>
	</OpenEventHub>
	<EventCompleted_Week1>
		<Action type="setVariable" boolVariable="StateOfDespair_Complete" boolValue="true" />
	</EventCompleted_Week1>
	<OpenMasterQuest>
		<Action type="checkRequirements">
			<Requirement type="gamestate" state="GameState_QuestProgress" />
			<True>
				<Action type="changeQuestForProgressState" name="StateOfDespair_MasterQuest" />
			</True>
			<False>
				<Action type="gotoState" state="GameState_QuestProgress" forceState="true">
					<Extras>
						<Attribute name="questParentDelegate" value="StateOfDespair_MasterQuest" />
					</Extras>
				</Action>
			</False>
		</Action>
	</OpenMasterQuest>
	<ShowJobList ignoreHUD="true">
		<Action type="checkRequirements">
			<Requirement type="land" land="Springfield" />
			<True>
				<Action type="if">
					<If>
						<Requirement type="active quest" quest="StateOfMine_1" />
						<Then>
							<Action type="gotoState" state="GameState_SpecialEventJobList">
								<Extras>
									<Attribute name="SpecialEvent" value="StateOfDespair_Event" />
									<Attribute name="JobList" value="StateOfDespair_JL_1" />
								</Extras>
							</Action>
						</Then>
					</If>
					<ElseIf>
						<Requirement type="active quest" quest="StateOfMine_2" />
						<Then>
							<Action type="gotoState" state="GameState_SpecialEventJobList">
								<Extras>
									<Attribute name="SpecialEvent" value="StateOfDespair_Event" />
									<Attribute name="JobList" value="StateOfDespair_JL_2" />
								</Extras>
							</Action>
						</Then>
					</ElseIf>
					<ElseIf>
						<Requirement type="active quest" quest="StateOfMine_3" />
						<Then>
							<Action type="gotoState" state="GameState_SpecialEventJobList">
								<Extras>
									<Attribute name="SpecialEvent" value="StateOfDespair_Event" />
									<Attribute name="JobList" value="StateOfDespair_JL_3" />
								</Extras>
							</Action>
						</Then>
					</ElseIf>
					<ElseIf>
						<Requirement type="active quest" quest="StateOfMine_4" />
						<Then>
							<Action type="gotoState" state="GameState_SpecialEventJobList">
								<Extras>
									<Attribute name="SpecialEvent" value="StateOfDespair_Event" />
									<Attribute name="JobList" value="StateOfDespair_JL_4" />
								</Extras>
							</Action>
						</Then>
					</ElseIf>
					<ElseIf>
						<Requirement type="active quest" quest="StateOfMine_5" />
						<Then>
							<Action type="gotoState" state="GameState_SpecialEventJobList">
								<Extras>
									<Attribute name="SpecialEvent" value="StateOfDespair_Event" />
									<Attribute name="JobList" value="StateOfDespair_JL_5" />
								</Extras>
							</Action>
						</Then>
					</ElseIf>
				</Action>
			</True>
			<False>
				<Action type="pantoobject" building="KrustylandShuttleToSpringfield" fakeTouch="true" />
			</False>
		</Action>
	</ShowJobList>
	<CheckIfEnd_Week ignoreHUD="true">
		<Action type="checkRequirements">
			<Requirement type="quest" quest="StateOfDespair_EventExpired" />
			<True>
				<Action type="setVariable" boolVariable="StateOfDespair_Expired" boolValue="true" />
			</True>
		</Action>
	</CheckIfEnd_Week>
	<PotBellyPigeonFeeder_Tapped parallel="true" ignoreHUD="true"></PotBellyPigeonFeeder_Tapped>
	<FieldTripMemorial_Init parallel="true" ignoreHUD="true">
		<Action type="setObjectVariable" variable="TapState" value="0" />
	</FieldTripMemorial_Init>
	<FieldTripMemorial_Tapped parallel="true" ignoreHUD="true">
		<Action type="setObjectVariable" variable="TapState" value="mod(Object::TapState+1,3)" asExpression="true" />
	</FieldTripMemorial_Tapped>
	<RecommendStoreCategory ignoreHUD="true">
		<Action type="reparseBuildMenu" />
		<Action type="clearRecommendations" category="Event" name="StateOfDespair_OnePanel" />
		<Action type="recommendation" recType="Event" name="StateOfDespair_OnePanel" eventName="UI_StateOfDespair_Title" limitedTime="true" limitedTimeEndDate="StateOfDespair_End" />
		<Action type="focusOnMenuItem" menuCategory="FrontPage" />
		<Action type="reparseBuildMenu" />
	</RecommendStoreCategory>
	<EnterStoreCategory ignoreHUD="true">
		<Action type="focusOnMenuItem" menuCategory="StateOfDespair_Category" />
	</EnterStoreCategory>
	<SkyFingerMonument_Start parallel="true">
		<Action type="actionSequence" script="MiscScripts:GoToInGameWithSound" />
		<Action type="pantoobject" building="SkyFingerMonument" fakeTouch="false" zoom="0.1" time="0" offsetX="_[gridToWorld(2)]_" offsetZ="_[-gridToWorld(2)]_" />
		<Action type="setMiniGameState" building="SkyFingerMonument" name="SkyFingerMonument" state="Playing" />
		<Action type="setMiniGameState" building="SkyFingerMonument" name="SkyFingerMonument" state="Ready" />
		<Action type="sound" sound="SkyFingerMonument_tap" />
		<Action type="setObjectVariable" onType="building" onObject="SkyFingerMonument" variable="Tapped" value="1" />
	</SkyFingerMonument_Start>
	<SkyFingerMonument_Tap_In_Done parallel="true">
		<Action type="collectAllTaxes" onBuilding="SkyFingerMonument" />
	</SkyFingerMonument_Tap_In_Done>
	<SkyFingerMonument_Tap_Out_Done parallel="true">
		<Action type="setObjectVariable" onType="building" onObject="SkyFingerMonument" variable="Tapped" value="0" />
	</SkyFingerMonument_Tap_Out_Done>
	<SkyFingerMonument_Rush>
		<Action type="sound" sound="UIButton" />
		<Action type="rushMinigame" minigame="SkyFingerMonument" />
	</SkyFingerMonument_Rush>
	<GoToFieldTripMemorial>
		<Action type="checkRequirements">
			<Requirements>
				<Requirement type="building" building="FieldTripMemorial" />
			</Requirements>
			<True>
				<Action type="pantoobject" building="FieldTripMemorial" />
			</True>
			<False>
				<Action type="focusOnMenuItem" itemName="FieldTripMemorial" inventory="true" />
			</False>
		</Action>
	</GoToFieldTripMemorial>
</ScriptPackage>