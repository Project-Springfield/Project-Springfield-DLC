<ScriptPackage>
	<MissionComplete parallel="true">
		<Action type="if">
			<If expression="(Plot_EPA_Active == 1)">
				<Then>
					<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Start_Plot_EPA" />
				</Then>
			</If>
			<ElseIf expression="(Plot_GHOST_Active == 1)">
				<Then>
					<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Start_Plot_GHOST" />
				</Then>
			</ElseIf>
			<ElseIf expression="(Plot_CIA_Active == 1)">
				<Then>
					<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Start_Plot_CIA" />
				</Then>
			</ElseIf>
			<ElseIf expression="(Plot_WallStreet_Active == 1)">
				<Then>
					<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Start_Plot_WallStreet" />
				</Then>
			</ElseIf>
		</Action>
	</MissionComplete>
	<Start_Plot_EPA>
		<Action type="if">
			<If>
				<Requirements>
					<Requirement type="quest started" quest="Plot_EPA_Master" not="true" />
					<Requirement type="timer" name="Plot_EPA_Master_Timer" state="active" not="true" />
				</Requirements>
				<Then>
					<Action type="program">
						<Program><![CDATA[
								#program;
                                var total = toDouble(System::getConfigValue('__SecretAgents_GameConfig:Plots:EPA_Total__'));
                                
                                for(var i = 0; i < total; i = i+1)
                                {
									var array = Array::create('name'=>'Plot_EPA_'+ toString(i + 1) + '_Timer','end'=>System::evaluate('Date::EPA_Plot_Gate_' + toString(i + 1)), 'expiryTime'=>serverTime(0) + fromDays(50));
									Timer::add(array);
                                }
								
								var timeArray = Array::create('name'=>'Plot_EPA_Master_Timer','expiryTime'=>serverTime(0) + fromDays(50));
								Timer::add(timeArray);
							]]></Program>
					</Action>
				</Then>
			</If>
		</Action>
	</Start_Plot_EPA>
	<EPA_ShowUnlockPopup>
		<Action type="updateVariable" variable="Plot_EPA_Visible" value="1" />
		<Action type="notification" title="UI_PLOTS_AgencyDiscovered_Title" button="UI_OK" text="UI_PLOTS_PlotDiscovered_Body1" icon="ICO_SecretAgents_EnemyBadge01" dismissOnOKOnly="true" />
		<Action type="runScript" script="SecretAgents_Scripts:Tab_SituationRoom" />
	</EPA_ShowUnlockPopup>
	<EPA_ShowOpenPopup parallel="true">
		<Action type="updateVariable" variable="DossierUnlocked_Show" value="1" />
	</EPA_ShowOpenPopup>
	<Plot_EPA_Finished>
		<Action type="runScript" script="MiscScripts:ReturnToGameState" />
		<Action type="showMenu" menu="ChiliadRewardPanel" scriptResProvider="ChiliadRewardPanel.mns" menuConfig="SecretAgents_Plots_MenuConfig:PlotDefeated_MenuConfig" buttonsConfig="SecretAgents_Plots_MenuConfig:DossierComplete_ButtonConfig" />
		<Action type="reward" save="true" SecretAgents_ActivePrizeTrackCurrency="toDouble(System::getConfigValue('__SecretAgents_GameConfig:Plots:Plot_Reward__'))" suppress_sound="true" />
		<Action type="reward" save="true" SecretAgents_Schematics="toDouble(System::getConfigValue('__SecretAgents_Spreadsheet_Config:Dossiers:Plot_CraftCurrencyEPA__'))" suppress_sound="true" />
		<Action type="program">
			<Program><![CDATA[
					#program;
					Timer::remove('Plot_EPA_Master_Timer');
					
					for(var i = 0; i < 9; i = i+1)
					{
						var timerName = 'Plot_EPA_'+ toString(i + 1) + '_Timer';
						Timer::remove(timerName);
					}
				]]></Program>
		</Action>
		<Action type="updateVariable" variable="Plot_EPA_Active" value="0" />
		<Action type="updateVariable" variable="Plot_GHOST_Active" value="1" />
		<Action type="rewardWithPlaceStore" attributes="DSH_MenuConfig:RewardWithPlaceStore">
			<Item type="building" name="ScreamapillarPond" />
		</Action>
	</Plot_EPA_Finished>
	<Plot_EPA_CompleteCMs>
		<Action type="if">
			<If expression="Plot_EPA_CompleteCMs &lt; (toDouble(System::getConfigValue('__SecretAgents_GameConfig:Plots:EPA_Total__'))-1)">
				<Then>
					<Action type="showMenu" menu="ChiliadRewardPanel" scriptResProvider="ChiliadRewardPanel.mns" menuConfig="SecretAgents_Plots_MenuConfig:DossierComplete_MenuConfig" buttonsConfig="SecretAgents_Plots_MenuConfig:DossierComplete_ButtonConfig" />
					<Action type="reward" save="true" SecretAgents_ActivePrizeTrackCurrency="toDouble(System::getConfigValue('__SecretAgents_Spreadsheet_Config:Dossiers:Dossier_PTCurrency__'))" suppress_sound="true" />
					<Action type="runScript" script="SecretAgents_Scripts:Tab_SituationRoom_ResetIndex" />
				</Then>
			</If>
		</Action>
		<Action type="updateVariable" variable="Plot_EPA_CompleteCMs" value="Plot_EPA_CompleteCMs + 1" />
		<Action type="program" formatMe="deep">
			<Objects>
				<String text="{QuestName}" />
			</Objects>
			<Program><![CDATA[
                    #program;
                    
                    var param1 = Array::create('type'=>'Score', 'source'=>'StrictlyPositiveCounter', 'extra'=>1);
                    var param2 = Array::create('type'=>'Score', 'source'=>'StrictlyPositiveCounter', 'extra'=>0);
                    var DNAArray = Array::create('id'=>3372, 'param1'=>param1, 'param2'=>param2);
					DNA::Add(DNAArray);
                    
					return Timer::remove(System::script['ObjectData'] + '_timer');
				]]></Program>
		</Action>
		<Action type="logevent" eventId="8010" formatMe="true" param1Type="Enumeration" param1="{QuestName}" param2Type="Enumeration" param2="Success" />
		<Action type="checkRequirements">
			<Requirement type="config" key="SecretAgents_GameConfig:EnabledNotifications:Dossier24" value="1" />
			<True>
				<Action type="scheduleLocalNotification" blueprint="Dossier24h" scheduleTime="24h" />
			</True>
		</Action>
	</Plot_EPA_CompleteCMs>
	<Plot_EPA_1_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_EPA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_EPA_1" />
		</Action>
	</Plot_EPA_1_Complete>
	<Plot_EPA_2_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_EPA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_EPA_2" />
		</Action>
	</Plot_EPA_2_Complete>
	<Plot_EPA_3_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_EPA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_EPA_3" />
		</Action>
	</Plot_EPA_3_Complete>
	<Plot_EPA_4_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_EPA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_EPA_4" />
		</Action>
	</Plot_EPA_4_Complete>
	<Plot_EPA_5_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_EPA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_EPA_5" />
		</Action>
	</Plot_EPA_5_Complete>
	<Plot_EPA_6_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_EPA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_EPA_6" />
		</Action>
	</Plot_EPA_6_Complete>
	<Plot_EPA_7_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_EPA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_EPA_7" />
		</Action>
	</Plot_EPA_7_Complete>
	<Plot_EPA_8_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_EPA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_EPA_8" />
		</Action>
	</Plot_EPA_8_Complete>
	<Plot_EPA_9_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_EPA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_EPA_9" />
		</Action>
	</Plot_EPA_9_Complete>
	<Start_Plot_GHOST>
		<Action type="if">
			<If>
				<Requirements>
					<Requirement type="quest started" quest="Plot_GHOST_Master" not="true" />
					<Requirement type="timer" name="Plot_GHOST_Master_Timer" state="active" not="true" />
					<Requirement type="time" start="GHOST_Plot_Gate_1" />
				</Requirements>
				<Then>
					<Action type="program">
						<Program><![CDATA[
                                #program;
                                var total = toDouble(System::getConfigValue('__SecretAgents_GameConfig:Plots:GHOST_Total__'));
								
								for(var i = 0; i < total; i = i+1)
								{
									var array = Array::create('name'=>'Plot_GHOST_'+ toString(i + 1) + '_Timer','end'=>System::evaluate('Date::GHOST_Plot_Gate_' + toString(i + 1)), 'expiryTime'=>serverTime(0) + fromDays(50));
									Timer::add(array);
								}

                                var timeArray = Array::create('name'=>'Plot_GHOST_Master_Timer','expiryTime'=>serverTime(0) + fromDays(50));
                                Timer::add(timeArray);
                            ]]></Program>
					</Action>
				</Then>
			</If>
		</Action>
	</Start_Plot_GHOST>
	<GHOST_ShowUnlockPopup>
		<Action type="updateVariable" variable="Plot_GHOST_Visible" value="1" />
		<Action type="updateVariable" variable="Plot_EPA_Visible" value="0" />
		<Action type="notification" title="UI_PLOTS_AgencyDiscovered_Title" button="UI_OK" text="UI_PLOTS_PlotDiscovered_Body2" icon="ICO_SecretAgents_EnemyBadge03" dismissOnOKOnly="true" />
		<Action type="runScript" script="SecretAgents_Scripts:Tab_SituationRoom" />
	</GHOST_ShowUnlockPopup>
	<GHOST_ShowOpenPopup parallel="true">
		<Action type="updateVariable" variable="DossierUnlocked_Show" value="1" />
	</GHOST_ShowOpenPopup>
	<Plot_GHOST_Finished>
		<Action type="runScript" script="MiscScripts:ReturnToGameState" />
		<Action type="showMenu" menu="ChiliadRewardPanel" scriptResProvider="ChiliadRewardPanel.mns" menuConfig="SecretAgents_Plots_MenuConfig:PlotDefeated_MenuConfig" buttonsConfig="SecretAgents_Plots_MenuConfig:DossierComplete_ButtonConfig" />
		<Action type="reward" save="true" SecretAgents_ActivePrizeTrackCurrency="toDouble(System::getConfigValue('__SecretAgents_GameConfig:Plots:Plot_Reward__'))" suppress_sound="true" />
		<Action type="reward" save="true" SecretAgents_Schematics="toDouble(System::getConfigValue('__SecretAgents_Spreadsheet_Config:Dossiers:Plot_CraftCurrencyGHOST__'))" suppress_sound="true" />
		<Action type="program">
			<Program><![CDATA[
                    #program;
                    Timer::remove('Plot_GHOST_Master_Timer');
					
                    for(var i = 0; i < 9; i = i+1)
                    {
                    var timerName = 'Plot_GHOST_'+ toString(i + 1) + '_Timer';
                    Timer::remove(timerName);
                    }
                ]]></Program>
		</Action>
		<Action type="updateVariable" variable="Plot_GHOST_Active" value="0" />
		<Action type="updateVariable" variable="Plot_CIA_Active" value="1" />
		<Action type="reward">
			<Item type="character" name="GHOSTEnforcer" useImmediately="true" />
		</Action>
	</Plot_GHOST_Finished>
	<Plot_GHOST_CompleteCMs>
		<Action type="if">
			<If expression="Plot_GHOST_CompleteCMs &lt; (toDouble(System::getConfigValue('__SecretAgents_GameConfig:Plots:GHOST_Total__'))-1)">
				<Then>
					<Action type="showMenu" menu="ChiliadRewardPanel" scriptResProvider="ChiliadRewardPanel.mns" menuConfig="SecretAgents_Plots_MenuConfig:DossierComplete_MenuConfig" buttonsConfig="SecretAgents_Plots_MenuConfig:DossierComplete_ButtonConfig" />
					<Action type="reward" save="true" SecretAgents_ActivePrizeTrackCurrency="toDouble(System::getConfigValue('__SecretAgents_Spreadsheet_Config:Dossiers:Dossier_PTCurrency__'))" suppress_sound="true" />
					<Action type="runScript" script="SecretAgents_Scripts:Tab_SituationRoom_ResetIndex" />
				</Then>
			</If>
		</Action>
		<Action type="updateVariable" variable="Plot_GHOST_CompleteCMs" value="Plot_GHOST_CompleteCMs + 1" />
		<Action type="program" formatMe="deep">
			<Objects>
				<String text="{QuestName}" />
			</Objects>
			<Program><![CDATA[
                    #program;
                    
                    var param1 = Array::create('type'=>'Score', 'source'=>'StrictlyPositiveCounter', 'extra'=>1);
                    var param2 = Array::create('type'=>'Score', 'source'=>'StrictlyPositiveCounter', 'extra'=>0);
                    var DNAArray = Array::create('id'=>3372, 'param1'=>param1, 'param2'=>param2);
                    DNA::Add(DNAArray);
                    
                    return Timer::remove(System::script['ObjectData'] + '_timer');
                ]]></Program>
		</Action>
		<Action type="logevent" eventId="8010" formatMe="true" param1Type="Enumeration" param1="{QuestName}" param2Type="Enumeration" param2="Success" />
		<Action type="checkRequirements">
			<Requirement type="config" key="SecretAgents_GameConfig:EnabledNotifications:Dossier24" value="1" />
			<True>
				<Action type="scheduleLocalNotification" blueprint="Dossier24h" scheduleTime="24h" />
			</True>
		</Action>
	</Plot_GHOST_CompleteCMs>
	<Plot_GHOST_1_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_GHOST_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_GHOST_1" />
		</Action>
	</Plot_GHOST_1_Complete>
	<Plot_GHOST_2_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_GHOST_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_GHOST_2" />
		</Action>
	</Plot_GHOST_2_Complete>
	<Plot_GHOST_3_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_GHOST_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_GHOST_3" />
		</Action>
	</Plot_GHOST_3_Complete>
	<Plot_GHOST_4_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_GHOST_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_GHOST_4" />
		</Action>
	</Plot_GHOST_4_Complete>
	<Plot_GHOST_5_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_GHOST_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_GHOST_5" />
		</Action>
	</Plot_GHOST_5_Complete>
	<Plot_GHOST_6_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_GHOST_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_GHOST_6" />
		</Action>
	</Plot_GHOST_6_Complete>
	<Plot_GHOST_7_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_GHOST_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_GHOST_7" />
		</Action>
	</Plot_GHOST_7_Complete>
	<Plot_GHOST_8_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_GHOST_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_GHOST_8" />
		</Action>
	</Plot_GHOST_8_Complete>
	<Plot_GHOST_9_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_GHOST_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_GHOST_9" />
		</Action>
	</Plot_GHOST_9_Complete>
	<Start_Plot_CIA>
		<Action type="if">
			<If>
				<Requirements>
					<Requirement type="quest started" quest="Plot_CIA_Master" not="true" />
					<Requirement type="timer" name="Plot_CIA_Master_Timer" state="active" not="true" />
					<Requirement type="time" start="CIA_Plot_Gate_1" />
				</Requirements>
				<Then>
					<Action type="program">
						<Program><![CDATA[
                                #program;
                                var total = toDouble(System::getConfigValue('__SecretAgents_GameConfig:Plots:CIA_Total__'));
                                
								for(var i = 0; i < total; i = i+1)
								{
									var array = Array::create('name'=>'Plot_CIA_'+ toString(i + 1) + '_Timer','end'=>System::evaluate('Date::CIA_Plot_Gate_' + toString(i + 1)), 'expiryTime'=>serverTime(0) + fromDays(50));
									Timer::add(array);
								}
								
                                var timeArray = Array::create('name'=>'Plot_CIA_Master_Timer','expiryTime'=>serverTime(0) + fromDays(50));
                                Timer::add(timeArray);
                            ]]></Program>
					</Action>
				</Then>
			</If>
		</Action>
	</Start_Plot_CIA>
	<CIA_ShowUnlockPopup>
		<Action type="updateVariable" variable="Plot_CIA_Visible" value="1" />
		<Action type="updateVariable" variable="Plot_GHOST_Visible" value="0" />
		<Action type="notification" title="UI_PLOTS_AgencyDiscovered_Title" button="UI_OK" text="UI_PLOTS_PlotDiscovered_Body3" icon="ICO_SecretAgents_EnemyBadge02" dismissOnOKOnly="true" />
		<Action type="runScript" script="SecretAgents_Scripts:Tab_SituationRoom" />
	</CIA_ShowUnlockPopup>
	<CIA_ShowOpenPopup parallel="true">
		<Action type="updateVariable" variable="DossierUnlocked_Show" value="1" />
	</CIA_ShowOpenPopup>
	<Plot_CIA_Finished>
		<Action type="runScript" script="MiscScripts:ReturnToGameState" />
		<Action type="showMenu" menu="ChiliadRewardPanel" scriptResProvider="ChiliadRewardPanel.mns" menuConfig="SecretAgents_Plots_MenuConfig:PlotDefeated_MenuConfig" buttonsConfig="SecretAgents_Plots_MenuConfig:DossierComplete_ButtonConfig" />
		<Action type="reward" save="true" SecretAgents_ActivePrizeTrackCurrency="toDouble(System::getConfigValue('__SecretAgents_GameConfig:Plots:Plot_Reward__'))" suppress_sound="true" />
		<Action type="reward" save="true" SecretAgents_Schematics="toDouble(System::getConfigValue('__SecretAgents_Spreadsheet_Config:Dossiers:Plot_CraftCurrencyCIA__'))" suppress_sound="true" />
		<Action type="program">
			<Program><![CDATA[
                    #program;
                    Timer::remove('Plot_CIA_Master_Timer');
					
                    for(var i = 0; i < 9; i = i+1)
                    {
                    var timerName = 'Plot_CIA_'+ toString(i + 1) + '_Timer';
                    Timer::remove(timerName);
                    }
                ]]></Program>
		</Action>
		<Action type="updateVariable" variable="Plot_CIA_Active" value="0" />
		<Action type="updateVariable" variable="Plot_WallStreet_Active" value="1" />
		<Action type="reward">
			<Item type="character" name="GrindhouseAssassin" useImmediately="true" />
		</Action>
	</Plot_CIA_Finished>
	<Plot_CIA_CompleteCMs>
		<Action type="if">
			<If expression="Plot_CIA_CompleteCMs &lt; (toDouble(System::getConfigValue('__SecretAgents_GameConfig:Plots:CIA_Total__'))-1)">
				<Then>
					<Action type="showMenu" menu="ChiliadRewardPanel" scriptResProvider="ChiliadRewardPanel.mns" menuConfig="SecretAgents_Plots_MenuConfig:DossierComplete_MenuConfig" buttonsConfig="SecretAgents_Plots_MenuConfig:DossierComplete_ButtonConfig" />
					<Action type="reward" save="true" SecretAgents_ActivePrizeTrackCurrency="toDouble(System::getConfigValue('__SecretAgents_Spreadsheet_Config:Dossiers:Dossier_PTCurrency__'))" suppress_sound="true" />
					<Action type="runScript" script="SecretAgents_Scripts:Tab_SituationRoom_ResetIndex" />
				</Then>
			</If>
		</Action>
		<Action type="updateVariable" variable="Plot_CIA_CompleteCMs" value="Plot_CIA_CompleteCMs + 1" />
		<Action type="program" formatMe="deep">
			<Objects>
				<String text="{QuestName}" />
			</Objects>
			<Program><![CDATA[
                    #program;
                    
                    var param1 = Array::create('type'=>'Score', 'source'=>'StrictlyPositiveCounter', 'extra'=>1);
                    var param2 = Array::create('type'=>'Score', 'source'=>'StrictlyPositiveCounter', 'extra'=>0);
                    var DNAArray = Array::create('id'=>3372, 'param1'=>param1, 'param2'=>param2);
                    DNA::Add(DNAArray);
                    
                    return Timer::remove(System::script['ObjectData'] + '_timer');
                ]]></Program>
		</Action>
		<Action type="logevent" eventId="8010" formatMe="true" param1Type="Enumeration" param1="{QuestName}" param2Type="Enumeration" param2="Success" />
		<Action type="checkRequirements">
			<Requirement type="config" key="SecretAgents_GameConfig:EnabledNotifications:Dossier24" value="1" />
			<True>
				<Action type="scheduleLocalNotification" blueprint="Dossier24h" scheduleTime="24h" />
			</True>
		</Action>
	</Plot_CIA_CompleteCMs>
	<Plot_CIA_1_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_CIA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_CIA_1" />
		</Action>
	</Plot_CIA_1_Complete>
	<Plot_CIA_2_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_CIA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_CIA_2" />
		</Action>
	</Plot_CIA_2_Complete>
	<Plot_CIA_3_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_CIA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_CIA_3" />
		</Action>
	</Plot_CIA_3_Complete>
	<Plot_CIA_4_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_CIA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_CIA_4" />
		</Action>
	</Plot_CIA_4_Complete>
	<Plot_CIA_5_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_CIA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_CIA_5" />
		</Action>
	</Plot_CIA_5_Complete>
	<Plot_CIA_6_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_CIA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_CIA_6" />
		</Action>
	</Plot_CIA_6_Complete>
	<Plot_CIA_7_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_CIA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_CIA_7" />
		</Action>
	</Plot_CIA_7_Complete>
	<Plot_CIA_8_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_CIA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_CIA_8" />
		</Action>
	</Plot_CIA_8_Complete>
	<Plot_CIA_9_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_CIA_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_CIA_9" />
		</Action>
	</Plot_CIA_9_Complete>
	<Start_Plot_WallStreet>
		<Action type="if">
			<If>
				<Requirements>
					<Requirement type="quest started" quest="Plot_WallStreet_Master" not="true" />
					<Requirement type="timer" name="Plot_WallStreet_Master_Timer" state="active" not="true" />
					<Requirement type="time" start="WallStreet_Plot_Gate_1" />
				</Requirements>
				<Then>
					<Action type="program">
						<Program><![CDATA[
                                #program;
                                var total = toDouble(System::getConfigValue('__SecretAgents_GameConfig:Plots:WallStreet_Total__'));
                                
								for(var i = 0; i < total; i = i+1)
								{
									var array = Array::create('name'=>'Plot_WallStreet_'+ toString(i + 1) + '_Timer','end'=>System::evaluate('Date::WallStreet_Plot_Gate_' + toString(i + 1)), 'expiryTime'=>serverTime(0) + fromDays(50));
									Timer::add(array);
								}


                                var timeArray = Array::create('name'=>'Plot_WallStreet_Master_Timer','expiryTime'=>serverTime(0) + fromDays(50));
                                Timer::add(timeArray);
                            ]]></Program>
					</Action>
				</Then>
			</If>
		</Action>
	</Start_Plot_WallStreet>
	<WallStreet_ShowUnlockPopup>
		<Action type="updateVariable" variable="Plot_WallStreet_Visible" value="1" />
		<Action type="updateVariable" variable="Plot_CIA_Visible" value="0" />
		<Action type="notification" title="UI_PLOTS_AgencyDiscovered_Title" button="UI_OK" text="UI_PLOTS_PlotDiscovered_Body4" icon="ICO_SecretAgents_EnemyBadge04" dismissOnOKOnly="true" />
		<Action type="runScript" script="SecretAgents_Scripts:Tab_SituationRoom" />
	</WallStreet_ShowUnlockPopup>
	<WallStreet_ShowOpenPopup parallel="true">
		<Action type="updateVariable" variable="DossierUnlocked_Show" value="1" />
	</WallStreet_ShowOpenPopup>
	<Plot_WallStreet_Finished>
		<Action type="runScript" script="MiscScripts:ReturnToGameState" />
		<Action type="showMenu" menu="ChiliadRewardPanel" scriptResProvider="ChiliadRewardPanel.mns" menuConfig="SecretAgents_Plots_MenuConfig:PlotDefeated_MenuConfig" buttonsConfig="SecretAgents_Plots_MenuConfig:DossierComplete_ButtonConfig" />
		<Action type="reward" save="true" SecretAgents_ActivePrizeTrackCurrency="toDouble(System::getConfigValue('__SecretAgents_GameConfig:Plots:Plot_Reward__'))" suppress_sound="true" />
		<Action type="reward" save="true" SecretAgents_Schematics="toDouble(System::getConfigValue('__SecretAgents_Spreadsheet_Config:Dossiers:Plot_CraftCurrencyWallStreet__'))" suppress_sound="true" />
		<Action type="program">
			<Program><![CDATA[
                    #program;
                    Timer::remove('Plot_WallStreet_Master_Timer');
					
                    for(var i = 0; i < 9; i = i+1)
                    {
                    var timerName = 'Plot_WallStreet_'+ toString(i + 1) + '_Timer';
                    Timer::remove(timerName);
                    }
                ]]></Program>
		</Action>
		<Action type="updateVariable" variable="Plot_WallStreet_Active" value="0" />
		<Action type="reward">
			<Item type="character" name="YakuzaBoss" useImmediately="true" />
		</Action>
	</Plot_WallStreet_Finished>
	<Plot_WallStreet_Plot_Finished>
		<Action type="runScript" script="MiscScripts:ReturnToGameState" />
		<Action type="updateVariable" variable="Plot_Visible_Plot" value="1" />
		<Action type="showMenu" menu="ChiliadRewardPanel" scriptResProvider="ChiliadRewardPanel.mns" menuConfig="SecretAgents_Plots_MenuConfig:PlotDefeated_MenuConfig" buttonsConfig="SecretAgents_Plots_MenuConfig:DossierComplete_ButtonConfig" />
		<Action type="reward" save="true" SecretAgents_ActivePrizeTrackCurrency="toDouble(System::getConfigValue('__SecretAgents_GameConfig:Plots:Plot_Reward__'))" suppress_sound="true" />
		<Action type="reward" save="true" SecretAgents_Schematics="toDouble(System::getConfigValue('__SecretAgents_Spreadsheet_Config:Dossiers:Plot_CraftCurrencyWallStreet__'))" suppress_sound="true" />
		<Action type="updateVariable" variable="Plot_WallStreet_CompleteCMs" value="0" />
	</Plot_WallStreet_Plot_Finished>
	<Plot_WallStreet_CompleteCMs>
		<Action type="if">
			<If expression="Plot_WallStreet_CompleteCMs &lt; (toDouble(System::getConfigValue('__SecretAgents_GameConfig:Plots:WallStreet_Total__'))-1)">
				<Then>
					<Action type="showMenu" menu="ChiliadRewardPanel" scriptResProvider="ChiliadRewardPanel.mns" menuConfig="SecretAgents_Plots_MenuConfig:DossierComplete_MenuConfig" buttonsConfig="SecretAgents_Plots_MenuConfig:DossierComplete_ButtonConfig" />
					<Action type="reward" save="true" SecretAgents_ActivePrizeTrackCurrency="toDouble(System::getConfigValue('__SecretAgents_Spreadsheet_Config:Dossiers:Dossier_PTCurrency__'))" suppress_sound="true" />
					<Action type="runScript" script="SecretAgents_Scripts:Tab_SituationRoom_ResetIndex" />
				</Then>
			</If>
		</Action>
		<Action type="updateVariable" variable="Plot_WallStreet_CompleteCMs" value="Plot_WallStreet_CompleteCMs + 1" />
		<Action type="program" formatMe="deep">
			<Objects>
				<String text="{QuestName}" />
			</Objects>
			<Program><![CDATA[
                    #program;
                    
                    var param1 = Array::create('type'=>'Score', 'source'=>'StrictlyPositiveCounter', 'extra'=>1);
                    var param2 = Array::create('type'=>'Score', 'source'=>'StrictlyPositiveCounter', 'extra'=>0);
                    var DNAArray = Array::create('id'=>3372, 'param1'=>param1, 'param2'=>param2);
                    DNA::Add(DNAArray);
                    
                    return Timer::remove(System::script['ObjectData'] + '_timer');
                ]]></Program>
		</Action>
		<Action type="logevent" eventId="8010" formatMe="true" param1Type="Enumeration" param1="{QuestName}" param2Type="Enumeration" param2="Success" />
		<Action type="checkRequirements">
			<Requirement type="config" key="SecretAgents_GameConfig:EnabledNotifications:Dossier24" value="1" />
			<True>
				<Action type="scheduleLocalNotification" blueprint="Dossier24h" scheduleTime="24h" />
			</True>
		</Action>
	</Plot_WallStreet_CompleteCMs>
	<Plot_WallStreet_1_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_WallStreet_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_WallStreet_1" />
		</Action>
	</Plot_WallStreet_1_Complete>
	<Plot_WallStreet_2_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_WallStreet_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_WallStreet_2" />
		</Action>
	</Plot_WallStreet_2_Complete>
	<Plot_WallStreet_3_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_WallStreet_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_WallStreet_3" />
		</Action>
	</Plot_WallStreet_3_Complete>
	<Plot_WallStreet_4_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_WallStreet_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_WallStreet_4" />
		</Action>
	</Plot_WallStreet_4_Complete>
	<Plot_WallStreet_5_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_WallStreet_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_WallStreet_5" />
		</Action>
	</Plot_WallStreet_5_Complete>
	<Plot_WallStreet_6_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_WallStreet_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_WallStreet_6" />
		</Action>
	</Plot_WallStreet_6_Complete>
	<Plot_WallStreet_7_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_WallStreet_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_WallStreet_7" />
		</Action>
	</Plot_WallStreet_7_Complete>
	<Plot_WallStreet_8_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_WallStreet_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_WallStreet_8" />
		</Action>
	</Plot_WallStreet_8_Complete>
	<Plot_WallStreet_9_Complete>
		<Action type="returnToInGameState" waitForState="true" />
		<Action type="actionSequence" script="SecretAgents_Plots_Scripts:Plot_WallStreet_CompleteCMs">
			<FormatToken key="QuestName" value="Plot_WallStreet_9" />
		</Action>
	</Plot_WallStreet_9_Complete>
</ScriptPackage>