<ScriptPackage>
	<DigSite_Tapped>
		<Action type="sound" sound="DigSite_PlayButton" />
		<Action type="anim-play" onBuilding="OldRuins" nowait="true" animation="DigSite_Neutral" loop="true" />
		<Action type="pantoobject" building="OldRuins" />
		<Action type="fitToScreen" targetObject="OldRuins" zoomSpeed="0.1">
			<Bounds xGrid="0" yGrid="-14" />
			<Bounds xGrid="14" yGrid="0" />
		</Action>
		<Action type="customTouch">
			<Attribute name="allowCameraMovement" value="false" />
			<Attribute name="loadScript" value="THOH2018_Scripts_ExcavationSite:StartMinigame" />
			<Attribute name="unloadScript" value="THOH2018_Scripts_ExcavationSite:EndMinigame" />
			<Attribute name="allowPrizePopups" value="false" />
			<Attribute name="config">
				<AttributeSet name="HiddenHUDElements">
					<Attribute name="EntireHUD" value="true" />
					<Attribute name="BottomButtons" value="true" />
					<Attribute name="SpecialEventButtons" value="true" />
					<Attribute name="Sidebar" value="true" />
					<Attribute name="Taskbar" value="true" />
					<Attribute name="Info" value="true" />
					<Attribute name="ShiftSpendable" value="true" />
					<Attribute name="HUDCurrencies" value="true" />
				</AttributeSet>
				<AttributeSet name="menuConfig">
					<Attribute name="file" value="THOH2018MiniGameHUDDigSite" />
					<Attribute name="config" value="THOH2018MinigameHUDDigSite.mns" />
					<Attribute name="file" value="MinigameHUDDigSite">
						<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
					</Attribute>
					<Attribute name="config" value="MinigameHUDDigSite.mns">
						<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
					</Attribute>
					<Attribute name="hud">
						<AttributeSet name="Currency1Icon">
							<Attribute name="image" program="Currency::getIconSmall('THOH2018_ActivePrizeTrackCurrency')" />
							<Attribute name="moveToDestination" value="THOH2018_ActivePrizeTrackCurrency" />
						</AttributeSet>
						<AttributeSet name="Currency1Text">
							<Attribute name="text" program="User::getCurrencyAmount('THOH2018_ActivePrizeTrackCurrency')" />
						</AttributeSet>
						<AttributeSet name="Currency2Icon">
							<Attribute name="image" program="Currency::getIconSmall('THOH2018_CurrencyCrafting')" />
							<Attribute name="moveToDestination" value="THOH2018_CurrencyCrafting" />
						</AttributeSet>
						<AttributeSet name="Currency2Text">
							<Attribute name="text" program="User::getCurrencyAmount('THOH2018_CurrencyCrafting')" />
						</AttributeSet>
						<AttributeSet name="Currency3Icon">
							<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" />
							<Attribute name="image" program="Currency::getIconSmall('THOH2018_ActivePrizeTrackCurrencyReward')" />
							<Attribute name="moveToDestination" value="THOH2018_ActivePrizeTrackCurrencyReward" />
						</AttributeSet>
						<AttributeSet name="Currency3Text">
							<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" />
							<Attribute name="text" program="User::getCurrencyAmount('THOH2018_ActivePrizeTrackCurrencyReward')" />
						</AttributeSet>
						<AttributeSet name="Currency1Icon">
							<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
							<Attribute name="image" program="Currency::getIconSmall('money')" />
							<Attribute name="moveToDestination" value="money" />
						</AttributeSet>
						<AttributeSet name="Currency1Text">
							<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
							<Attribute name="text" program="User::getCurrencyAmount('money')" />
						</AttributeSet>
						<AttributeSet name="Currency2Icon">
							<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
							<Attribute name="image" program="Currency::getIconSmall('xp')" />
							<Attribute name="moveToDestination" value="xp" />
						</AttributeSet>
						<AttributeSet name="Currency2Text">
							<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
							<Attribute name="text" program="User::getCurrencyAmount('xp')" />
						</AttributeSet>
						<AttributeSet name="ResourceIcon">
							<Attribute name="image" program="Currency::getIconSmall('THOH2018_CurrencyDigging')" />
						</AttributeSet>
						<AttributeSet name="ResourceText">
							<Attribute name="text" program="User::getCurrencyAmount('THOH2018_CurrencyDigging')" />
						</AttributeSet>
						<AttributeSet name="HelpIconHL">
							<Attribute name="image" value="ICO_THOH_Help_SM.rgb" />
						</AttributeSet>
						<AttributeSet name="HelpIcon">
							<Attribute name="image" value="ICO_THOH_Help_SM.rgb" />
						</AttributeSet>
						<AttributeSet name="HelpButton">
							<Attribute name="script" value="THOH2018_Scripts_ExcavationSite:HelpButton" />
						</AttributeSet>
						<AttributeSet name="ExitButton">
							<Attribute name="script" value="THOH2018_Scripts_ExcavationSite:ExitButton" />
						</AttributeSet>
						<AttributeSet name="onBackButton">
							<Attribute name="mapTo" value="ExitButton" />
						</AttributeSet>
					</Attribute>
				</AttributeSet>
				<AttributeSet name="touchables">
					<Attribute name="objects" value="OldRuins" />
					<Attribute name="ignoreObjectTypes" value="character|flyby" />
					<Attribute name="runOnTouchScriptsInstantly" value="true" />
				</AttributeSet>
				<AttributeSet name="onTouchStartedScripts">
					<Attribute name="OldRuins" value="THOH2018_Scripts_ExcavationSite:DigSite_TappedInMinigame" />
				</AttributeSet>
			</Attribute>
		</Action>
	</DigSite_Tapped>
	<HelpButton ignoreHUD="true">
		<Action type="if">
			<If expression="THOH2018_DigSiteFoundState == 0">
				<Then>
					<Action type="actionSequence" script="THOH2018_Scripts:GuidePanel_ExcavationSite_ReturnToExcavationMinigame" />
				</Then>
			</If>
		</Action>
	</HelpButton>
	<ExitButton ignoreHUD="true">
		<Action type="if">
			<If expression="THOH2018_DigSiteFoundState == 0">
				<Then>
					<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:ShowSummaryScreen" />
				</Then>
			</If>
		</Action>
	</ExitButton>
	<ShowSummaryScreen ignoreHUD="true">
		<Action type="if">
			<If expression="((THOH2018_DigSiteFoundState == 1) + THOH2018_DigSiteFoundxp + THOH2018_DigSiteFoundTHOH2018_ActivePrizeTrackCurrency) &gt; 0">
				<Then>
					<Action type="if">
						<If expression="THOH2018_DigSiteFoundState">
							<Then>
								<Action type="sound" sound="TTT_DigSite_TreasureFound" />
							</Then>
						</If>
						<Else>
							<Then>
								<Action type="sound" sound="TTT_DigSite_TreasureFound" />
							</Then>
						</Else>
					</Action>
					<Action type="showMenu" menu="gnomeradarrewardpopup" scriptResProvider="gnomeradarrewardpopup.mns" menuConfig="THOH2018_DigSiteSummary_MenuConfig:MenuConfig" buttonsConfig="THOH2018_DigSiteSummary_MenuConfig:ButtonsConfig" waitUntilDismissed="true" />
				</Then>
			</If>
		</Action>
		<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:EndMinigame" />
		<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:ZoomOut" />
		<Action type="gotoState" state="GameState_InGame" />
	</ShowSummaryScreen>
	<ResumeMinigame>
		<Action type="hideAllBuildings" hide="true" belowPointTarget="OldRuins" exceptBuildings="OldRuins" />
		<Action type="hideAllCharacters" hide="true" />
		<Action type="hideAllFlyBys" hide="true" />
		<Action type="anim-play" onBuilding="OldRuins" nowait="true" animation="DigSite_Neutral" loop="true" />
	</ResumeMinigame>
	<ZoomOut parallel="true" ignoreHUD="true">
		<Action type="pantoobject" building="OldRuins" zoom="0.6" time="0.5" waitUntilComplete="true" />
		<Action type="pantoobject" building="OldRuins" zoom="0.6" time="0.5" waitUntilComplete="true" />
	</ZoomOut>
	<StartMinigame>
		<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:ResumeMinigame" />
		<Action type="program">
			<Program><![CDATA[
                    User::setVariable('THOH2018_DigSiteFoundState', 0, 0);
                    User::setVariable('THOH2018_DigSiteFoundTHOH2018_ActivePrizeTrackCurrencyReward', 0, 0);
                    User::setVariable('THOH2018_DigSiteFoundTHOH2018_ActivePrizeTrackCurrency', 0, 0);
                    User::setVariable('THOH2018_DigSiteFoundTHOH2018_CurrencyCrafting', 0, 0);
                    User::setVariable('THOH2018_DigSiteFoundxp', 0, 0);
                    User::setVariable('THOH2018_DigSiteFoundmoney', 0, 0);
                ]]></Program>
		</Action>
		<Action type="if">
			<If expression="#program;                 var building = Land::getFirstInstanceOfObject(Building::find('OldRuins'));                 if(!isNULL(building))                 {                     var dig = Object::getVariableAsNumber(building,'Dig');                     var treasure = Object::getVariableAsNumber(building,'DigTreasure');                                          if ((dig &amp; treasure) == 0)                     {                         return true;                     }                 }                 return false;">
				<Then>
					<Action type="scheduleScript" mode="create" shouldSave="true" persistUntilComplete="true" relativeTime="5s" script="THOH2018_Scripts_ExcavationSite:DoTreasureFound" />
					<Action type="runScript" script="THOH2018_Scripts_ExcavationSite:TreasureFound" />
				</Then>
			</If>
		</Action>
	</StartMinigame>
	<EndMinigame>
		<Action type="hideAllBuildings" hide="false" />
		<Action type="hideAllCharacters" hide="false" />
		<Action type="hideAllFlyBys" hide="false" />
	</EndMinigame>
	<DigSite_TappedInMinigameHandleTap>
		<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:DigSite_TappedInMinigameNormal" />
		<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:ShowShovelPromptIfValid" />
	</DigSite_TappedInMinigameHandleTap>
	<DigSite_TappedInMinigameInternal>
		<Action type="program">
			<Program><![CDATA[
                    #program;
                    var digCurrencyName = 'THOH2018_CurrencyDigging';
                    var buildingName = 'OldRuins';
                    var buildingSkinName = 'OldRuins02';
                    var tapResultVariableName = 'THOH2018_DigSiteTapResult';
                    
                    var hook = 'THOH2018_Hooks';
                    Hook::load(hook,false);
                    var compiledHook = Parser::compile(Hook::toString(hook+':DigSite_TappedInMinigameInternal'));
                    Hook::unload(hook,false);
                    
                    Parser::evaluate(compiledHook);
                ]]></Program>
		</Action>
		<Action type="checkExpression" expression="THOH2018_DigSiteTapResult">
			<ExpressionCase value="1">
				<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:DigSite_TappedInMinigameHandleTap" />
			</ExpressionCase>
			<ExpressionCase value="2">
				<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:DigSite_TappedInMinigameHandleTap" />
			</ExpressionCase>
		</Action>
	</DigSite_TappedInMinigameInternal>
	<DigSite_TappedInMinigame ignoreHUD="true" parallel="true" runQueueState="RunInAnyState">
		<Action type="if">
			<If expression="THOH2018_DigSiteFoundState == 0">
				<Then>
					<Action type="program">
						<Program><![CDATA[
                                User::setVariable('THOH2018_DigSiteFoundState', 4, false);
                            ]]></Program>
					</Action>
					<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:DigSite_TappedInMinigameInternal" />
					<Action type="if">
						<If expression="THOH2018_DigSiteFoundState == 1">
							<Then>
								<Action type="scheduleScript" mode="create" shouldSave="true" persistUntilComplete="true" relativeTime="5s" script="THOH2018_Scripts_ExcavationSite:DoTreasureFound" />
								<Action type="runScript" script="THOH2018_Scripts_ExcavationSite:TreasureFound" />
							</Then>
						</If>
						<ElseIf expression="THOH2018_DigSiteFoundState == 2">
							<Then>
								<Action type="runScript" script="THOH2018_Scripts_ExcavationSite:ConfirmOpenShovelStore" />
							</Then>
						</ElseIf>
					</Action>
					<Action type="program">
						<Program><![CDATA[
                                if (User::getVariable('THOH2018_DigSiteFoundState') == 4)
                                {
                                    User::setVariable('THOH2018_DigSiteFoundState', 0, false);
                                }
                            ]]></Program>
					</Action>
				</Then>
			</If>
		</Action>
	</DigSite_TappedInMinigame>
	<DigSite_TappedInMinigameNormal ignoreHUD="true" parallel="true" runQueueState="RunInAnyState">
		<Action type="checkRequirements" ignoreObject="false">
			<Requirements>
				<Requirement type="active quest" quest="THOH2018_DCS_CompleteDigs" />
				<Requirement type="special currency" currency="THOH2018_CurrencyDigging" amount="1" />
			</Requirements>
			<True>
				<Action type="setVariable" intVariable="THOH2018_DCS_CompleteDigs" intValue="THOH2018_DCS_CompleteDigs+1" />
			</True>
		</Action>
		<Action type="program">
			<Program><![CDATA[
                    #program;
                    //Game Data
                    var buildingName = 'OldRuins';
                    var buildingSkinName = 'OldRuins02';
                    var digCurrencyName = 'THOH2018_CurrencyDigging';
                    var activeCurrencyName = 'THOH2018_ActivePrizeTrackCurrency';

                    //Flyby
                    //Update the single dig tap flybys?
                    var flyByName = 'DigSite_Tap';

                    //Variables
                    var digSiteFoundState = 'THOH2018_DigSiteFoundState';
                    //Update these variables if we have a excavation DCS
                    var DCS_Excavations_Name = 'TTT_DCS_Excavations';
                    var DCS_TreasuresName = 'TTT_DCS_LostTreasure';
                    var activeTreasuresName = 'THOH2018_ActivePrizeTrackCurrencyReward';
                    var digSite_CanShowShovelPrompt = 'THOH2018_DigSite_CanShowShovelPrompt';
                    var digSiteFoundName = 'THOH2018_DigSiteFound';
                    var digSiteCumulativeFoundName = 'THOH2018_DigSiteCumulativeFound';

                    //Sound files
                    var treasureFoundSoundName = 'TTT_DigSite_LostTreasure';
                    var rockFoundSoundName = 'DigSite_RelicNotFound';
                    var prizeFoundSoundName = 'DigSite_RelicFound';
                    var digSoundName = 'TTT_DigSite_Dig';

                    //Balance config
                    var balanceConfigLocationName = 'THOH2018_BalanceConfig:DigSite_Rewards';
                    var gameConfigLocationName = 'THOH2018_GameConfig:DigSite';

                    var hook = 'THOH2018_Hooks';
                    Hook::load(hook,false);
                    var compiledHook = Parser::compile(Hook::toString(hook+':DigSite_TappedInMinigameNormal'));
                    Hook::unload(hook,false);
                    
                    Parser::evaluate(compiledHook);

                ]]></Program>
		</Action>
		<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:RefreshShovelCounter" parseOnDemand="true" />
		<Action type="runScript" script="THOH2018_Scripts_ExcavationSite:RefreshHUDAfterDigging" />
	</DigSite_TappedInMinigameNormal>
	<TreasureFound ignoreHUD="True">
		<Action type="delay" time="0.1" />
		<Action type="updateMenuItem" menu="eMenu_CustomTouch">
			<Attribute name="containerConfig">
				<AttributeSet>
					<Attribute name="visible" value="false" />
					<Attribute name="active" value="false" />
				</AttributeSet>
			</Attribute>
		</Action>
		<Action type="delay" time="0.5" />
		<Action type="program">
			<Program><![CDATA[
                    #program;
                    //Game Data
                    var buildingName = 'OldRuins';

                    //Variables
                    var activeTreasuresName = 'THOH2018_ActivePrizeTrackCurrencyReward';
                    //Update if there is a DCS
                    var DCS_TreasuresName = 'TTT_DCS_LostTreasure';
                    var digSiteFoundState = 'THOH2018_DigSiteFoundState';
                    var digSiteFoundName = 'THOH2018_DigSiteFound';
                    var digSiteCumulativeFoundName = 'THOH2018_DigSiteCumulativeFound';

                    //Sound files
                    var treasureFoundSoundName = 'TTT_DigSite_LostTreasure';
                    var rockFoundSoundName = 'DigSite_RelicNotFound';
                    var prizeFoundSoundName = 'DigSite_RelicFound';
                    var digSoundName = 'TTT_DigSite_Dig';

                    var balanceConfigLocationName = 'THOH2018_BalanceConfig:DigSite_Rewards';
                    var gameConfigLocationName = 'THOH2018_GameConfig:DigSite';

                    var hook = 'THOH2018_Hooks';
                    Hook::load(hook,false);
                    var compiledHook = Parser::compile(Hook::toString(hook+':TreasureFound'));
                    Hook::unload(hook,false);
                    
                    Parser::evaluate(compiledHook);
                ]]></Program>
		</Action>
		<Action type="delay" time="2.5" />
		<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:DoTreasureFound" />
	</TreasureFound>
	<DoTreasureFound>
		<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:ShowSummaryScreen" />
		<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:AdvanceDigSite" />
		<Action type="scheduleScript" mode="delete" script="THOH2018_Scripts_ExcavationSite:DoTreasureFound" />
	</DoTreasureFound>
	<AdvanceDigSite ignoreHUD="true">
		<Action type="program">
			<Program><![CDATA[
                    #program;
                    var buildingName = 'OldRuins';
                    var buildingSkinName = 'OldRuins02';
                    //Update flyby for refilling the digsite?
                    var flyByName = 'DigSite_Fill0';

                    var hook = 'THOH2018_Hooks';
                    Hook::load(hook,false);
                    var compiledHook = Parser::compile(Hook::toString(hook+':AdvanceDigSite'));
                    Hook::unload(hook,false);
                    
                    Parser::evaluate(compiledHook);
                ]]></Program>
		</Action>
		<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:ResetDigSite" />
	</AdvanceDigSite>
	<ResetDigSite ignoreHUD="true">
		<Action type="program">
			<Program><![CDATA[
                    #program;
                    var buildingName = 'OldRuins';
                    var balanceConfigLocationName = 'THOH2018_BalanceConfig:DigSite_Rewards';

                    var hook = 'THOH2018_Hooks';
                    Hook::load(hook,false);
                    var compiledHook = Parser::compile(Hook::toString(hook+':ResetDigSite'));
                    Hook::unload(hook,false);
                    
                    Parser::evaluate(compiledHook);
                ]]></Program>
		</Action>
	</ResetDigSite>
	<RefreshShovelCounter ignoreHUD="true" parallel="true" runQueueState="RunInAnyState">
		<Action type="updateMenuItem" menu="eMenu_CustomTouch">
			<Attribute name="config">
				<AttributeSet name="ResourceIcon">
					<Attribute name="image" program="Currency::getIconSmall('THOH2018_CurrencyDigging')" />
				</AttributeSet>
				<AttributeSet name="ResourceText">
					<Attribute name="text" program="User::getCurrencyAmount('THOH2018_CurrencyDigging')" />
				</AttributeSet>
			</Attribute>
		</Action>
	</RefreshShovelCounter>
	<RefreshHUDAfterDigging ignoreHUD="true" parallel="true" runQueueState="RunInAnyState">
		<Action type="delay" time="0.6" />
		<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:RefreshHUD" parseOnDemand="true" />
	</RefreshHUDAfterDigging>
	<RefreshHUD ignoreHUD="true" parallel="true" runQueueState="RunInAnyState">
		<Action type="updateMenuItem" menu="eMenu_CustomTouch">
			<Attribute name="config">
				<AttributeSet name="Currency1Icon">
					<Attribute name="image" program="Currency::getIconSmall('THOH2018_ActivePrizeTrackCurrency')" />
					<Attribute name="moveToDestination" value="THOH2018_ActivePrizeTrackCurrency" />
				</AttributeSet>
				<AttributeSet name="Currency1Text">
					<Attribute name="text" program="User::getCurrencyAmount('THOH2018_ActivePrizeTrackCurrency')" />
				</AttributeSet>
				<AttributeSet name="Currency2Icon">
					<Attribute name="image" program="Currency::getIconSmall('THOH2018_CurrencyCrafting')" />
					<Attribute name="moveToDestination" value="THOH2018_CurrencyCrafting" />
				</AttributeSet>
				<AttributeSet name="Currency2Text">
					<Attribute name="text" program="User::getCurrencyAmount('THOH2018_CurrencyCrafting')" />
				</AttributeSet>
				<AttributeSet name="Currency3Icon">
					<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" />
					<Attribute name="image" program="Currency::getIconSmall('THOH2018_ActivePrizeTrackCurrencyReward')" />
					<Attribute name="moveToDestination" value="THOH2018_ActivePrizeTrackCurrencyReward" />
				</AttributeSet>
				<AttributeSet name="Currency3Text">
					<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" />
					<Attribute name="text" program="User::getCurrencyAmount('THOH2018_ActivePrizeTrackCurrencyReward')" />
				</AttributeSet>
				<AttributeSet name="Currency1Icon">
					<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
					<Attribute name="image" program="Currency::getIconSmall('money')" />
					<Attribute name="moveToDestination" value="money" />
				</AttributeSet>
				<AttributeSet name="Currency1Text">
					<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
					<Attribute name="text" program="User::getCurrencyAmount('money')" />
				</AttributeSet>
				<AttributeSet name="Currency2Icon">
					<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
					<Attribute name="image" program="Currency::getIconSmall('xp')" />
					<Attribute name="moveToDestination" value="xp" />
				</AttributeSet>
				<AttributeSet name="Currency2Text">
					<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
					<Attribute name="text" program="User::getCurrencyAmount('xp')" />
				</AttributeSet>
				<AttributeSet name="ResourceIcon">
					<Attribute name="image" program="Currency::getIconSmall('THOH2018_CurrencyDigging')" />
				</AttributeSet>
				<AttributeSet name="ResourceText">
					<Attribute name="text" program="User::getCurrencyAmount('THOH2018_CurrencyDigging')" />
				</AttributeSet>
			</Attribute>
		</Action>
	</RefreshHUD>
	<ConfirmOpenShovelStore ignoreHUD="true">
		<Action type="program">
			<Program><![CDATA[
                    User::setVariable('THOH2018_DigSiteFoundState', 0, false);
                ]]></Program>
		</Action>
		<Action type="if">
			<If>
				<Requirement type="active quest" quest="BitingBack_3" objective="2" />
				<Then>
					<Action type="notification" title="UI_THOH2018_OpenPickaxeStore_Title" button="UI_OK" text="UI_THOH2018_DigSite_ExtraPickaxes_Body" icon="ICO_CUR_THOH2018_CurrencyDigSite_LG" />
					<Action type="program">
						<Program><![CDATA[
                                User::addCurrencyAmount('THOH2018_CurrencyDigging', 10);
                            ]]></Program>
					</Action>
					<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:RefreshHUD" parseOnDemand="true" />
				</Then>
			</If>
			<Else>
				<Then>
					<Action type="userConfirmation" title="UI_THOH2018_OpenPickaxeStore_Title" text="UI_THOH2018_OpenPickaxeStore_Body" text_yes="GEN_Buy" text_no="GEN_Exit" var="THOH2018_ExcavationSite_OpenShovelStore" />
					<Action type="checkExpression" expression="THOH2018_ExcavationSite_OpenShovelStore">
						<ExpressionCase value="1">
							<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:OpenShovelStore" />
						</ExpressionCase>
						<ExpressionCase value="0">
							<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:ShowSummaryScreen" />
						</ExpressionCase>
					</Action>
				</Then>
			</Else>
		</Action>
	</ConfirmOpenShovelStore>
	<OpenShovelStore>
		<Action type="focusOnMenuItem" allowInLand="any" minimalStoreFile="THOH2018_ShovelsPackStoreMenu.xml" menuCategory="THOH2018_GetMorePickaxes" onExitButtonLeaveStore="THOH2018_Scripts_ExcavationSite:StoreExitButton" onLeaveStore="THOH2018_Scripts_ExcavationSite:ReturnFromStore" />
	</OpenShovelStore>
	<StoreExitButton>
		<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:ReturnFromStore" />
		<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:ExitButton" />
	</StoreExitButton>
	<ReturnFromStore>
		<Action type="customTouch">
			<Attribute name="allowCameraMovement" value="false" />
			<Attribute name="loadScript" value="THOH2018_Scripts_ExcavationSite:ResumeMinigame" />
			<Attribute name="unloadScript" value="THOH2018_Scripts_ExcavationSite:EndMinigame" />
			<Attribute name="allowPrizePopups" value="false" />
			<Attribute name="config">
				<AttributeSet name="HiddenHUDElements">
					<Attribute name="EntireHUD" value="true" />
					<Attribute name="BottomButtons" value="true" />
					<Attribute name="SpecialEventButtons" value="true" />
					<Attribute name="Sidebar" value="true" />
					<Attribute name="Taskbar" value="true" />
					<Attribute name="Info" value="true" />
					<Attribute name="ShiftSpendable" value="true" />
					<Attribute name="HUDCurrencies" value="true" />
				</AttributeSet>
				<AttributeSet name="menuConfig">
					<Attribute name="file" value="THOH2018MiniGameHUDDigSite" />
					<Attribute name="config" value="THOH2018MinigameHUDDigSite.mns" />
					<Attribute name="file" value="MinigameHUDDigSite">
						<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
					</Attribute>
					<Attribute name="config" value="MinigameHUDDigSite.mns">
						<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
					</Attribute>
					<Attribute name="hud">
						<AttributeSet name="Currency1Icon">
							<Attribute name="image" program="Currency::getIconSmall('THOH2018_ActivePrizeTrackCurrency')" />
							<Attribute name="moveToDestination" value="THOH2018_ActivePrizeTrackCurrency" />
						</AttributeSet>
						<AttributeSet name="Currency1Text">
							<Attribute name="text" program="User::getCurrencyAmount('THOH2018_ActivePrizeTrackCurrency')" />
						</AttributeSet>
						<AttributeSet name="Currency2Icon">
							<Attribute name="image" program="Currency::getIconSmall('THOH2018_CurrencyCrafting')" />
							<Attribute name="moveToDestination" value="THOH2018_CurrencyCrafting" />
						</AttributeSet>
						<AttributeSet name="Currency2Text">
							<Attribute name="text" program="User::getCurrencyAmount('THOH2018_CurrencyCrafting')" />
						</AttributeSet>
						<AttributeSet name="Currency3Icon">
							<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" />
							<Attribute name="image" program="Currency::getIconSmall('THOH2018_ActivePrizeTrackCurrencyReward')" />
							<Attribute name="moveToDestination" value="THOH2018_ActivePrizeTrackCurrencyReward" />
						</AttributeSet>
						<AttributeSet name="Currency3Text">
							<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" />
							<Attribute name="text" program="User::getCurrencyAmount('THOH2018_ActivePrizeTrackCurrencyReward')" />
						</AttributeSet>
						<AttributeSet name="Currency1Icon">
							<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
							<Attribute name="image" program="Currency::getIconSmall('money')" />
							<Attribute name="moveToDestination" value="money" />
						</AttributeSet>
						<AttributeSet name="Currency1Text">
							<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
							<Attribute name="text" program="User::getCurrencyAmount('money')" />
						</AttributeSet>
						<AttributeSet name="Currency2Icon">
							<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
							<Attribute name="image" program="Currency::getIconSmall('xp')" />
							<Attribute name="moveToDestination" value="xp" />
						</AttributeSet>
						<AttributeSet name="Currency2Text">
							<Requirement type="reqList" location="THOH2018_Requirements:Event_Active" not="true" />
							<Attribute name="text" program="User::getCurrencyAmount('xp')" />
						</AttributeSet>
						<AttributeSet name="ResourceIcon">
							<Attribute name="image" program="Currency::getIconSmall('THOH2018_CurrencyDigging')" />
						</AttributeSet>
						<AttributeSet name="ResourceText">
							<Attribute name="text" program="User::getCurrencyAmount('THOH2018_CurrencyDigging')" />
						</AttributeSet>
						<AttributeSet name="HelpIconHL">
							<Attribute name="image" value="ICO_THOH_Help_SM.rgb" />
						</AttributeSet>
						<AttributeSet name="HelpIcon">
							<Attribute name="image" value="ICO_THOH_Help_SM.rgb" />
						</AttributeSet>
						<AttributeSet name="HelpButton">
							<Attribute name="script" value="THOH2018_Scripts_ExcavationSite:HelpButton" />
						</AttributeSet>
						<AttributeSet name="ExitButton">
							<Attribute name="script" value="THOH2018_Scripts_ExcavationSite:ExitButton" />
						</AttributeSet>
						<AttributeSet name="onBackButton">
							<Attribute name="mapTo" value="ExitButton" />
						</AttributeSet>
					</Attribute>
				</AttributeSet>
				<AttributeSet name="touchables">
					<Attribute name="objects" value="OldRuins" />
					<Attribute name="ignoreObjectTypes" value="character|flyby" />
					<Attribute name="runOnTouchScriptsInstantly" value="true" />
				</AttributeSet>
				<AttributeSet name="onTouchStartedScripts">
					<Attribute name="OldRuins" value="THOH2018_Scripts_ExcavationSite:DigSite_TappedInMinigame" />
				</AttributeSet>
			</Attribute>
		</Action>
	</ReturnFromStore>
	<ShowShovelPromptIfValid>
		<Action type="if">
			<If expression="Global::getVariable('THOH2018_DigSite_CanShowShovelPrompt')==1 &amp;&amp; User::getCurrencyAmount('THOH2018_CurrencyDigging')==0">
				<Then>
					<Action type="program">
						<Program><![CDATA[
								User::setVariable('THOH2018_DigSiteFoundState', 2, false);
							]]></Program>
					</Action>
				</Then>
			</If>
		</Action>
		<Action type="program">
			<Program><![CDATA[
					Global::setVariable('THOH2018_DigSite_CanShowShovelPrompt', 0);
				]]></Program>
		</Action>
	</ShowShovelPromptIfValid>
	<PostEventClean parallel="true" runQueueState="RunInAnyState">
		<Action type="actionSequence" script="THOH2018_Scripts_ExcavationSite:ResetDigSite" />
	</PostEventClean>
	<GiveDigSiteReward>
		<Action type="if">
			<If expression="THOH2018_DigSiteFoundItem == 1">
				<Then>
					<Action type="updateVariable" variable="THOH2018_DigSiteFoundItem" value="0" />
					<Action type="rewardWithPlaceStore" attributes="TimeTravellingToaster_MenuConfig:RewardWithPlaceStore">
						<Item type="building" name="FlyingBats" />
					</Action>
				</Then>
			</If>
			<ElseIf expression="THOH2018_DigSiteFoundItem == 2">
				<Then>
					<Action type="updateVariable" variable="THOH2018_DigSiteFoundItem" value="0" />
					<Action type="rewardWithPlaceStore" attributes="TimeTravellingToaster_MenuConfig:RewardWithPlaceStore">
						<Item type="building" name="BonePile" />
					</Action>
				</Then>
			</ElseIf>
			<ElseIf expression="THOH2018_DigSiteFoundItem &gt;= 3 &amp;&amp; THOH2018_DigSiteFoundItem &lt;= 4">
				<Then>
					<Action type="updateVariable" variable="THOH2018_DigSiteFoundItem" value="0" />
					<Action type="rewardWithPlaceStore" attributes="TimeTravellingToaster_MenuConfig:RewardWithPlaceStore">
						<Item type="building" name="VampireCasket" />
					</Action>
				</Then>
			</ElseIf>
			<ElseIf expression="THOH2018_DigSiteFoundItem &gt;= 5 &amp;&amp; THOH2018_DigSiteFoundItem &lt;= 9">
				<Then>
					<Action type="updateVariable" variable="THOH2018_DigSiteFoundItem" value="0" />
					<Action type="rewardWithPlaceStore" attributes="TimeTravellingToaster_MenuConfig:RewardWithPlaceStore">
						<Item type="building" name="SkeletonPile" />
					</Action>
				</Then>
			</ElseIf>
			<ElseIf expression="THOH2018_DigSiteFoundItem &gt;= 10 &amp;&amp; THOH2018_DigSiteFoundItem &lt;= 19">
				<Then>
					<Action type="updateVariable" variable="THOH2018_DigSiteFoundItem" value="0" />
					<Action type="rewardWithPlaceStore" attributes="TimeTravellingToaster_MenuConfig:RewardWithPlaceStore">
						<Item type="building" name="FlamingTorch" />
					</Action>
				</Then>
			</ElseIf>
			<ElseIf expression="THOH2018_DigSiteFoundItem &gt;= 20 &amp;&amp; THOH2018_DigSiteFoundItem &lt;= 29">
				<Then>
					<Action type="updateVariable" variable="THOH2018_DigSiteFoundItem" value="0" />
					<Action type="rewardWithPlaceStore" attributes="TimeTravellingToaster_MenuConfig:RewardWithPlaceStore">
						<Item type="building" name="GargoyleWall" />
					</Action>
				</Then>
			</ElseIf>
			<ElseIf expression="THOH2018_DigSiteFoundItem &gt;= 30 &amp;&amp; THOH2018_DigSiteFoundItem &lt;= 40">
				<Then>
					<Action type="updateVariable" variable="THOH2018_DigSiteFoundItem" value="0" />
					<Action type="rewardWithPlaceStore" attributes="TimeTravellingToaster_MenuConfig:RewardWithPlaceStore">
						<Item type="building" name="HangingStreetLamp" />
					</Action>
				</Then>
			</ElseIf>
			<ElseIf expression="THOH2018_DigSiteFoundItem &gt;= 41 &amp;&amp; THOH2018_DigSiteFoundItem &lt;= 60">
				<Then>
					<Action type="updateVariable" variable="THOH2018_DigSiteFoundItem" value="0" />
					<Action type="rewardWithPlaceStore" attributes="TimeTravellingToaster_MenuConfig:RewardWithPlaceStore">
						<Item type="building" name="IronWall" />
					</Action>
				</Then>
			</ElseIf>
			<ElseIf expression="THOH2018_DigSiteFoundItem &gt;= 61 &amp;&amp; THOH2018_DigSiteFoundItem &lt;= 80">
				<Then>
					<Action type="updateVariable" variable="THOH2018_DigSiteFoundItem" value="0" />
					<Action type="rewardWithPlaceStore" attributes="TimeTravellingToaster_MenuConfig:RewardWithPlaceStore">
						<Item type="building" name="DeadTree" />
					</Action>
				</Then>
			</ElseIf>
			<ElseIf expression="THOH2018_DigSiteFoundItem &gt;= 81 &amp;&amp; THOH2018_DigSiteFoundItem &lt;= 100">
				<Then>
					<Action type="updateVariable" variable="THOH2018_DigSiteFoundItem" value="0" />
					<Action type="rewardWithPlaceStore" attributes="TimeTravellingToaster_MenuConfig:RewardWithPlaceStore">
						<Item type="building" name="RuinedWall" />
					</Action>
				</Then>
			</ElseIf>
		</Action>
	</GiveDigSiteReward>
</ScriptPackage>